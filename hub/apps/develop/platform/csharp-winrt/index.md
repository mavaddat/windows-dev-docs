---
description: C#/WinRT is a tool set that provides WinRT projection support for C# code.
title: C#/WinRT
ms.date: 05/19/2020
ms.topic: article
keywords: windows 10, uwp, standard, c#, winrt, cswinrt, projection
ms.localizationpriority: medium
---

# C#/WinRT

C#/WinRT is a NuGet-packaged toolkit that provides Windows Runtime (WinRT) projection support for the C# language. A projection assembly is an interop assembly, which enables programming WinRT APIs in a natural and familiar way for the target language. The C#/WinRT projection hides the details of interop between C# and WinRT interfaces, and provides mappings of many [WinRT types to appropriate .NET equivalents](net-mappings-of-winrt-types.md), such as strings, URIs, common value types, and generic collections.

C#/WinRT currently provides support for consuming WinRT APIs through the use of [Target Framework Monikers](../../../desktop/modernize/desktop-to-uwp-enhance.md) (TFMs) in .NET. Setting the TFM with a specific Windows SDK version adds references to the Windows SDK projection and runtime assemblies generated by C#/WinRT.

The [C#/WinRT NuGet package](https://www.nuget.org/packages/Microsoft.Windows.CsWinRT/) enables you to [create](#generate-and-distribute-an-interop-assembly) and [reference](#reference-an-interop-assembly) your own WinRT interop assemblies for .NET consumers. The latest C#/WinRT version also includes a [preview of authoring](create-windows-runtime-component-cswinrt.md) WinRT types in C#.

For additional information, see the [C#/WinRT GitHub repo](https://aka.ms/cswinrt/repo).

## Motivation for C#/WinRT

[.NET](/dotnet/fundamentals/) (previously known as .NET Core) is an open-source, cross-platform runtime that can be used to build device, cloud, and IoT applications.

Previous versions of .NET Framework and .NET Core had built-in knowledge of WinRT&mdash;a Windows-specific technology. To support the portability and efficiency goals of .NET 6+, we lifted the WinRT projection support out of the .NET compiler and runtime and moved it into the C#/WinRT toolkit (see [Built-in support for WinRT is removed from .NET](/dotnet/core/compatibility/interop/5.0/built-in-support-for-winrt-removed)). The goal of C#/WinRT is to provide parity with the built-in WinRT support provided by earlier versions of the C# compiler and .NET runtime. For details, see [.NET mappings of Windows Runtime types](net-mappings-of-winrt-types.md).

C#/WinRT also supports components in the [Windows App SDK](../../../windows-app-sdk/index.md), including WinUI 3. The Windows App SDK lifts native Microsoft UI controls and other native components out of the operating system. This enables app developers to use the latest controls and components on Windows 10, version 1809, and later releases.

Finally, C#/WinRT is a general toolkit and is intended to support other scenarios where built-in support for WinRT is not available in the C# compiler or .NET runtime.

## What's new

The latest C#/WinRT releases can be found on our [release notes](https://github.com/microsoft/CsWinRT/releases) page in the Github repo.

## Usage

The C#/WinRT NuGet package can be used to both generate C# projections (also called interop assemblies) from WinRT components and in [Authoring C#/WinRT components](https://github.com/microsoft/CsWinRT/blob/master/docs/authoring.md). For more details regarding the usage scenarios for C#/WinRT, refer to the [usage guide](https://github.com/microsoft/CsWinRT/blob/master/docs/usage.md) on our repo.

### Generate and distribute an interop assembly

WinRT APIs are defined in Windows Metadata (WinMD) files. The C#/WinRT NuGet package ([Microsoft.Windows.CsWinRT](https://www.nuget.org/packages/Microsoft.Windows.CsWinRT/)) includes the C#/WinRT compiler, **cswinrt.exe**, which you can use to process WinMD files and generate .NET C# code. C#/WinRT compiles these source files into an interop assembly, similar to how [C++/WinRT](/windows/uwp/cpp-and-winrt-apis) generates headers for the C++ language projection. You can then distribute the C#/WinRT interop assembly along with the implementation assembly for .NET applications to reference, typically as a NuGet package.

For more details on how to generate and distribute an interop assembly, see [Generate a C# projection from a C++/WinRT component, distribute as a NuGet for .NET apps](net-projection-from-cppwinrt-component.md).

### Reference an interop assembly

Typically, C#/WinRT interop assemblies are referenced by application projects. But they may also be referenced in turn by intermediate interop assemblies. For example, the WinUI interop assembly would reference the Windows SDK interop assembly.

If you distribute a third-party WinRT component without an official interop assembly, an application project may follow the procedure for [generating an interop assembly](#generate-and-distribute-an-interop-assembly) to generate its own private projection sources. We don't recommend this approach, because it can produce conflicting projections of the same type within a process. NuGet packaging, following the [Semantic Versioning](https://semver.org) scheme, is designed to prevent this. An official third-party interop assembly is preferred.

### Embedded support for WinRT types (Preview) 

Starting with C#/WinRT version 1.4.1, support is included for embedding Windows SDK projection and runtime sources for both .NET and .NET Standard 2.0 into your library or app's output. This is useful in cases where usage of Windows SDK types is self-contained. Embedded support removes dependencies on WinRT.Runtime.dll and Microsoft.Windows.SDK.NET.dll which reduces the library or app output size. It also allows library developers to provide downlevel support and removes the need for multi-targeting.

For more details, see the [C#/WinRT embedded documentation](https://github.com/microsoft/CsWinRT/blob/master/docs/embedded.md) on our repo.

### WinRT type activation

C#/WinRT supports activation of WinRT types hosted by the operating system, as well as third-party components such as [Win2D](https://www.nuget.org/packages/Win2D.uwp/). Support for third-party component activation in a desktop application is enabled with registration free WinRT activation (see [Enhancing Non-packaged Desktop Apps using Windows Runtime Components](https://blogs.windows.com/windowsdeveloper/2019/04/30/enhancing-non-packaged-desktop-apps-using-windows-runtime-components/)), available in Windows 10, version 1903 and later. Native C++ components should set the **Windows Desktop Compatible** property to *True* either via the project properties or the `.vcxproj` file, in order to reference and forward the **Microsoft.VCLibs.Desktop** binaries to consuming apps. Otherwise, the [VCRT Forwarders](https://www.nuget.org/packages/Microsoft.VCRTForwarders.140/) package will be required by consuming apps if the component targets UWP apps only.

C#/WinRT also provides an activation fallback path if Windows fails to activate the type as described above. In this case, C#/WinRT attempts to locate a native implementation DLL based on the fully qualified type name, progressively removing elements. For example, the fallback logic would attempt to activate the Contoso.Controls.Widget type from the following modules, in sequence:

1. Contoso.Controls.Widget.dll
2. Contoso.Controls.dll
3. Contoso.dll

C#/WinRT uses the [LoadLibrary alternate search order](/windows/win32/dlls/dynamic-link-library-search-order#alternate-search-order-for-desktop-applications) to locate an implementation DLL. An app relying on this fallback behavior should package the implementation DLL alongside the app module.

## Common errors and troubleshooting

- Error: "Windows Metadata not provided or detected."

  You can specify Windows Metadata by using the `<CsWinRTWindowsMetadata>` project property, for example:

  ```xml
  <CsWinRTWindowsMetadata>10.0.19041.0</CsWinRTWindowsMetadata>
  ```

  In C#/WinRT version 1.2.1 and later, this property defaults to `TargetPlatformVersion`, which is derived from the Windows SDK version specified in the `TargetFramework` property.
  
- Error	CS0246: The type or namespace name 'Windows' could not be found (are you missing a using directive or an assembly reference?)

  To address this error, edit your `<TargetFramework>` property to target a specific Windows version, for example:
  ```xml
  <TargetFramework>net8.0-windows10.0.19041.0</TargetFramework>
  ```
  Refer to the docs on [Calling Windows Runtime APIs](../../../desktop/modernize/desktop-to-uwp-enhance.md) for more details on specifying the `<TargetFramework>` property.
  
- [**System.InvalidCastException**](/dotnet/api/system.invalidcastexception) when casting to an interface that has the `ComImport` attribute
 
  When casting an object to an interface that has the `ComImport` attribute, you'll need to use the `.As<>` operator instead of using an explicit [cast expression](/dotnet/csharp/language-reference/operators/type-testing-and-cast#cast-expression). For example:
  
  ```csharp
  someObject.As<SomeComImportInterface>
  ```
  
  For more details, see the [COM interop guide](https://github.com/microsoft/CsWinRT/blob/master/docs/interop.md).
  
- System.Runtime.InteropServices.COMException: Class not registered (0x80040154 (REGDB_E_CLASSNOTREG))

  - If you see this exception when consuming a C#/WinRT projection from a C++/WinRT component, make sure the component has set the **Windows Desktop Compatible** property to *True* either via the project properties or via the `.vcxproj` file.

### .NET SDK versioning errors

You may encounter the following errors or warnings in a project that is built with an earlier .NET SDK version than any of its dependencies.

| Error or warning message | Reason |
|--------------------------|--------|
| Warning MSB3277: Found conflicts between different versions of WinRT.Runtime or Microsoft.Windows.SDK.NET that could not be resolved. | This build warning occurs when referencing a library that exposes Windows SDK types on its API surface. |
| [Error CS1705](/dotnet/csharp/language-reference/compiler-messages/cs1705): Assembly 'AssemblyName1' uses 'TypeName' which has a higher version than referenced assembly 'AssemblyName2' | This build compiler error occurs when referencing and consuming exposed Windows SDK types in a library. |
| System.IO.FileLoadException | This runtime error may occur when calling certain APIs in a library that does not expose Windows SDK types. |

To fix these errors, update your .NET SDK to the latest version. Doing so will ensure that the runtime and Windows SDK assembly versions used by your application are compatible with all dependencies. These errors may occur with early servicing/feature updates to the .NET SDK, because runtime fixes may require updates to our assembly versions.

## Known issues

Known issues and breaking changes are noted in the [C#/WinRT GitHub repo](https://aka.ms/cswinrt/repo).

If you encounter any functional issues with the C#/WinRT NuGet package, the cswinrt.exe compiler, or the generated projection sources, submit issues to us via the [C#/WinRT issues page](https://github.com/microsoft/CsWinRT/issues).

## Additional resources

* [C#/WinRT GitHub repo](https://aka.ms/cswinrt/repo)
